---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const projects = await getCollection("projects");
const sortedProjects = projects.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<BaseLayout title="Projects | Bitcraft">
  <h1 class="text-4xl font-bold text-dark-olive mb-4">Projects</h1>
  <p class="text-lg text-near-black font-sans mb-8">
    Our portfolio of web experiences and tools.
  </p>

  {
    sortedProjects.length === 0 ? (
      <div class="p-4 bg-off-white rounded-lg border border-olive-drab">
        <code class="text-sm font-mono text-dark-olive">Coming soon...</code>
      </div>
    ) : (
      <ul class="space-y-6">
        {sortedProjects.map((project) => (
          <li class="p-4 bg-off-white rounded-lg border border-olive-drab">
            <a
              href={`/projects/${project.id}`}
              class="block hover:opacity-80 transition-opacity"
            >
              <h2 class="text-2xl font-bold text-dark-olive mb-2">
                {project.data.title}
              </h2>
              <p class="text-near-black mb-2">{project.data.description}</p>
              <time
                datetime={project.data.pubDate.toISOString()}
                class="text-sm text-olive-drab"
              >
                {project.data.pubDate.toLocaleDateString("en-US", {
                  year: "numeric",
                  month: "long",
                  day: "numeric",
                })}
              </time>
            </a>
            {project.data.repository && (
              <a
                href={project.data.repository}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-block mt-2 text-sm text-olive-drab hover:text-dark-olive underline"
              >
                View Repository
              </a>
            )}
          </li>
        ))}
      </ul>
    )
  }
</BaseLayout>
